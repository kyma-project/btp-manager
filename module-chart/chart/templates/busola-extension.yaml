apiVersion: v1
kind: ConfigMap
metadata:
  name: btpoperator-module
  namespace: {{ .Release.Namespace }}
  labels:
    app.kubernetes.io/managed-by: kyma
    app.kubernetes.io/name: btp-manager
    app.kubernetes.io/part-of: Kyma
    busola.io/extension: resource
    busola.io/extension-version: '0.5'
    kyma-project.io/module: btp-operator
    operator.kyma-project.io/managed-by: kyma
data:
  general: |-
    resource:
      kind: BtpOperator
      group: operator.kyma-project.io
      version: v1alpha1
    name: BTP Operators
    category: Configuration
    urlPath: btpoperators
    scope: namespace
    description: >-
      BTP Operator enables consumption of SAP BTP services in your Kubernetes cluster.
    features:
      actions:
        disableCreate: true
        disableDelete: true
  
  list: |-
    - name: State
      source: status.state
      widget: Badge
      highlights:
        positive:
          - Ready
        negative:
          - Error
          - Deleting
        critical:
          - Warning
        informative:
          - Processing
    - name: Age
      source: metadata.creationTimestamp
      sort: true
      widget: Age
  
  details: |-
    header:
      - name: Module Status
        source: status.state
        widget: Badge
        highlights:
          positive:
            - Ready
          negative:
            - Error
            - Deleting
          critical:
            - Warning
          informative:
            - Processing
      - name: Namespace
        source: metadata.namespace
      - name: Generation
        source: metadata.generation
    
    body:
      - name: Module Overview
        widget: Panel
        children:
          - name: Status
            source: status.state
            widget: Badge
            highlights:
              positive:
                - Ready
              negative:
                - Error
              informative:
                - Processing
          - name: Module Name
            source: "'btp-operator'"
          - name: Namespace
            source: metadata.namespace
          - name: Created
            source: metadata.creationTimestamp
            widget: Age
      
      - name: Health Status
        widget: Panel
        children:
          - name: Module State
            widget: PlainText
            source: >-
              ($state := status.state;
               $state = 'Ready' ? '✅ Module is healthy and operational' :
               $state = 'Processing' ? '⏳ Module is being processed' :
               $state = 'Error' ? '❌ Module encountered an error' :
               $state = 'Warning' ? '⚠️ Module has warnings' :
               '⚪ Status unknown')
          - name: Ready Conditions
            widget: PlainText
            source: >-
              ($total := $count(status.conditions);
               $ready := $count(status.conditions[status='True']);
               $ready & ' / ' & $total & ' conditions are ready')
      
      - name: SAP BTP Service Operator Components
        widget: Panel
        children:
          - name: SAP BTP Operator Controller
            source: "'sap-btp-operator-controller-manager'"
          - name: BTP Manager Controller
            source: "'btp-manager-controller-manager'"
      
      - name: Status Details
        widget: Panel
        children:
          - name: State
            source: status.state
          - name: Conditions
            source: status.conditions
            widget: ConditionList
          - name: Observed Generation
            source: status.observedGeneration
            visibility: $exists(status.observedGeneration)
      
      - name: Metadata
        widget: Panel
        children:
          - name: Labels
            source: metadata.labels
            widget: Labels
          - name: Annotations
            source: metadata.annotations
            widget: Labels
            visibility: $exists(metadata.annotations)
          - name: Finalizers
            source: metadata.finalizers
            visibility: $exists(metadata.finalizers)
      
      - name: Specification
        widget: Panel
        children:
          - name: Spec
            source: spec
            widget: CodeViewer
            language: yaml
    
    resourceGraph:
      colorVariant: 1
      dataSources:
        - source: relatedDeployments
        - source: relatedServices
        - source: relatedPods
  
  dataSources: |-
    relatedDeployments:
      resource:
        kind: Deployment
        version: v1
        group: apps
      filter: $item.metadata.labels.`kyma-project.io/module` = "btp-operator"
    relatedServices:
      resource:
        kind: Service
        version: v1
      filter: $item.metadata.labels.`kyma-project.io/module` = "btp-operator"
    relatedPods:
      resource:
        kind: Pod
        version: v1
      filter: $item.metadata.labels.`kyma-project.io/module` = "btp-operator"
